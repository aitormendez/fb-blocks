"use strict";(globalThis.webpackChunkfb_blocks=globalThis.webpackChunkfb_blocks||[]).push([[135],{135:(t,i,e)=>{e.r(i),e.d(i,{HLSProvider:()=>r});var s=e(607),n=e(933);e(609);class a{#t;#i;#e=null;#s=null;config={};#n=new Set;get instance(){return this.#e}constructor(t,i){this.#t=t,this.#i=i}setup(t){const{streamType:i}=this.#i.$state,e=(0,s.peek)(i).includes("live"),a=(0,s.peek)(i).includes("ll-");this.#e=new t({lowLatencyMode:a,backBufferLength:a?4:e?8:void 0,renderTextTracksNatively:!1,...this.config});const o=this.#a.bind(this);for(const i of Object.values(t.Events))this.#e.on(i,o);this.#e.on(t.Events.ERROR,this.#o.bind(this));for(const t of this.#n)t(this.#e);this.#i.player.dispatch("hls-instance",{detail:this.#e}),this.#e.attachMedia(this.#t),this.#e.on(t.Events.AUDIO_TRACK_SWITCHED,this.#r.bind(this)),this.#e.on(t.Events.LEVEL_SWITCHED,this.#c.bind(this)),this.#e.on(t.Events.LEVEL_LOADED,this.#h.bind(this)),this.#e.on(t.Events.LEVEL_UPDATED,this.#l.bind(this)),this.#e.on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.#d.bind(this)),this.#e.on(t.Events.CUES_PARSED,this.#u.bind(this)),this.#i.qualities[n.kW.enableAuto]=this.#v.bind(this),(0,s.listenEvent)(this.#i.qualities,"change",this.#p.bind(this)),(0,s.listenEvent)(this.#i.audioTracks,"change",this.#b.bind(this)),this.#s=(0,s.effect)(this.#y.bind(this))}#E(t,i){return new s.DOMEvent((t=>(0,s.camelToKebabCase)(t))(t),{detail:i})}#y(){if(!this.#i.$state.live())return;const t=new n.e8(this.#g.bind(this));return t.start(),t.stop.bind(t)}#g(){this.#i.$state.liveSyncPosition.set(this.#e?.liveSyncPosition??1/0)}#a(t,i){this.#i.player?.dispatch(this.#E(t,i))}#d(t,i){const e=this.#E(t,i);let s=-1;for(let t=0;t<i.tracks.length;t++){const a=i.tracks[t],o=a.subtitleTrack??a.closedCaptions,r=new n.to({id:`hls-${a.kind}-${t}`,src:o?.url,label:a.label,language:o?.lang,kind:a.kind,default:a.default});r[n.Hp.readyState]=2,r[n.Hp.onModeChange]=()=>{"showing"===r.mode?(this.#e.subtitleTrack=t,s=t):s===t&&(this.#e.subtitleTrack=-1,s=-1)},this.#i.textTracks.add(r,e)}}#u(t,i){const e=this.#e?.subtitleTrack,s=this.#i.textTracks.getById(`hls-${i.type}-${e}`);if(!s)return;const n=this.#E(t,i);for(const t of i.cues)t.positionAlign="auto",s.addCue(t,n)}#r(t,i){const e=this.#i.audioTracks[i.id];if(e){const s=this.#E(t,i);this.#i.audioTracks[n.jH.select](e,!0,s)}}#c(t,i){const e=this.#i.qualities[i.level];if(e){const s=this.#E(t,i);this.#i.qualities[n.jH.select](e,!0,s)}}#l(t,i){i.details.totalduration>0&&this.#i.$state.inferredLiveDVRWindow.set(i.details.totalduration)}#h(t,i){if(this.#i.$state.canPlay())return;const{type:e,live:a,totalduration:o,targetduration:r}=i.details,c=this.#E(t,i);this.#i.notify("stream-type-change",a?"EVENT"===e&&Number.isFinite(o)&&r>=10?"live:dvr":"live":"on-demand",c),this.#i.notify("duration-change",o,c);const h=this.#e.media;-1===this.#e.currentLevel&&this.#i.qualities[n.kW.setAuto](!0,c);for(const t of this.#e.audioTracks){const i={id:t.id.toString(),label:t.name,language:t.lang||"",kind:"main"};this.#i.audioTracks[n.jH.add](i,c)}for(const t of this.#e.levels){const i={id:t.id?.toString()??t.height+"p",width:t.width,height:t.height,codec:t.codecSet,bitrate:t.bitrate};this.#i.qualities[n.jH.add](i,c)}h.dispatchEvent(new s.DOMEvent("canplay",{trigger:c}))}#o(t,i){i.fatal&&("mediaError"===i.type?this.#e?.recoverMediaError():this.#f(i.error))}#f(t){this.#i.notify("error",{message:t.message,code:1,error:t})}#v(){this.#e&&(this.#e.currentLevel=-1)}#p(){const{qualities:t}=this.#i;this.#e&&!t.auto&&(this.#e[t.switch+"Level"]=t.selectedIndex,n.G_&&(this.#t.currentTime=this.#t.currentTime))}#b(){const{audioTracks:t}=this.#i;this.#e&&this.#e.audioTrack!==t.selectedIndex&&(this.#e.audioTrack=t.selectedIndex)}onInstance(t){return this.#n.add(t),()=>this.#n.delete(t)}loadSource(t){(0,s.isString)(t.src)&&this.#e?.loadSource(t.src)}destroy(){this.#e?.destroy(),this.#e=null,this.#s?.(),this.#s=null}}class o{#S;#i;#L;constructor(t,i,e){this.#S=t,this.#i=i,this.#L=e,this.#x()}async#x(){const t={onLoadStart:this.#k.bind(this),onLoaded:this.#w.bind(this),onLoadError:this.#T.bind(this)};let i=await async function(t,i={}){if((0,s.isString)(t)){i.onLoadStart?.();try{if(await(0,n.k0)(t),!(0,s.isFunction)(window.Hls))throw Error("");const e=window.Hls;return i.onLoaded?.(e),e}catch(t){i.onLoadError?.(t)}}}(this.#S,t);if((0,s.isUndefined)(i)&&!(0,s.isString)(this.#S)&&(i=await async function(t,i={}){if(!(0,s.isUndefined)(t)){if(i.onLoadStart?.(),t.prototype&&t.prototype!==Function)return i.onLoaded?.(t),t;try{const e=(await t())?.default;if(!e||!e.isSupported)throw Error("");return i.onLoaded?.(e),e}catch(t){i.onLoadError?.(t)}}}(this.#S,t)),!i)return null;if(!i.isSupported()){const t="[vidstack] `hls.js` is not supported in this environment";return this.#i.player.dispatch(new s.DOMEvent("hls-unsupported")),this.#i.notify("error",{message:t,code:4}),null}return i}#k(){this.#i.player.dispatch(new s.DOMEvent("hls-lib-load-start"))}#w(t){this.#i.player.dispatch(new s.DOMEvent("hls-lib-loaded",{detail:t})),this.#L(t)}#T(t){const i=(0,n.rv)(t);this.#i.player.dispatch(new s.DOMEvent("hls-lib-load-error",{detail:i})),this.#i.notify("error",{message:i.message,code:4,error:i})}}class r extends n.Nw{$$PROVIDER_TYPE="HLS";#m=null;#D=new a(this.video,this.ctx);get ctor(){return this.#m}get instance(){return this.#D.instance}static supported=(0,n.m0)();get type(){return"hls"}get canLiveSync(){return!0}#O="https://cdn.jsdelivr.net/npm/hls.js@^1.5.0/dist/hls.min.js";get config(){return this.#D.config}set config(t){this.#D.config=t}get library(){return this.#O}set library(t){this.#O=t}preconnect(){(0,s.isString)(this.#O)&&(0,n.TB)(this.#O)}setup(){super.setup(),new o(this.#O,this.ctx,(t=>{this.#m=t,this.#D.setup(t),this.ctx.notify("provider-setup",this);const i=(0,s.peek)(this.ctx.$state.source);i&&this.loadSource(i)}))}async loadSource(t,i){(0,s.isString)(t.src)?(this.media.preload=i||"",this.appendSource(t,"application/x-mpegurl"),this.#D.loadSource(t),this.currentSrc=t):this.removeSource()}onInstance(t){const i=this.#D.instance;return i&&t(i),this.#D.onInstance(t)}destroy(){this.#D.destroy()}}}}]);